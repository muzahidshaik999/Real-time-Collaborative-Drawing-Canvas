<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Collaborative Canvas</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      /* small quality-of-life defaults if not already in style.css */
      html, body { height: 100%; margin: 0; }
      #app { display: flex; flex-direction: column; height: 100%; }
      #toolbar {
        display: flex; flex-wrap: wrap; gap: 10px; align-items: center;
        padding: 8px 10px; border-bottom: 1px solid #1f2937; background: #0f172a; color: #e2e8f0;
      }
      #statusBar {
        margin-left: auto; display: flex; gap: 10px; align-items: center; font-size: 12px; opacity: 0.85;
      }
      #canvasWrap { position: relative; flex: 1; background: #0b1020; }
      #canvas { position: absolute; inset: 0; width: 100%; height: 100%; display: block; }
      #cursors { position: absolute; inset: 0; pointer-events: none; }
      #footer {
        padding: 6px 10px; background: #0f172a; color: #94a3b8; border-top: 1px solid #1f2937;
        display: flex; justify-content: space-between; align-items: center;
      }
    </style>
  </head>
  <body>
    <noscript>
      <div style="padding:12px;background:#fee2e2;color:#7f1d1d;text-align:center;">
        This app requires JavaScript to run.
      </div>
    </noscript>

    <div id="app">
      <div id="toolbar">
        <label>Tool:
          <select id="tool" title="Choose a tool">
            <option value="pencil">âœï¸ Pencil</option>
            <option value="eraser">ğŸ§½ Eraser</option>
            <option value="line">ğŸ“ Line</option>
            <option value="rect">â¬› Rectangle</option>
            <option value="circle">âšª Circle</option>
            <option value="triangle">ğŸ”º Triangle</option>
            <option value="symbol">ğŸ”· Shapes</option>
          </select>
        </label>

        <label>Color:
          <input type="color" id="color" value="#000000" />
        </label>

        <label>Width:
          <input type="range" id="width" min="1" max="40" value="4" />
        </label>

        <label id="shapeLabel">Shapes:
          <select id="shapeSymbols" title="Pick a symbol to stamp (when tool = Shapes)">
            <optgroup label="Geometric">
              <option value="â– ">â–  Black square</option>
              <option value="â–¡">â–¡ White square</option>
              <option value="â–ª">â–ª Small black square</option>
              <option value="â–«">â–« Small white square</option>
              <option value="â—">â— Black circle</option>
              <option value="â—‹">â—‹ White circle</option>
              <option value="â—‰">â—‰ Bullseye circle</option>
              <option value="â—¯">â—¯ Large circle</option>
              <option value="â—">â— Left half circle</option>
              <option value="â—‘">â—‘ Right half circle</option>
              <option value="â—’">â—’ Bottom half circle</option>
              <option value="â—“">â—“ Top half circle</option>
              <option value="â–²">â–² Up triangle (filled)</option>
              <option value="â–³">â–³ Up triangle (empty)</option>
              <option value="â–¼">â–¼ Down triangle (filled)</option>
              <option value="â–½">â–½ Down triangle (empty)</option>
              <option value="â–¶">â–¶ Right triangle (filled)</option>
              <option value="â–·">â–· Right triangle (empty)</option>
              <option value="â—€">â—€ Left triangle (filled)</option>
              <option value="â—">â— Left triangle (empty)</option>
              <option value="â—†">â—† Diamond (filled)</option>
              <option value="â—‡">â—‡ Diamond (empty)</option>
              <option value="â¬Ÿ">â¬Ÿ Hexagon</option>
              <option value="â¬¢">â¬¢ Black hexagon</option>
              <option value="â¬£">â¬£ White hexagon</option>
            </optgroup>
            <optgroup label="Stars & Polygons">
              <option value="â˜…">â˜… Black star</option>
              <option value="â˜†">â˜† White star</option>
              <option value="âœ¦">âœ¦ Four-point star</option>
              <option value="âœ§">âœ§ Four-point star (open)</option>
              <option value="âœ©">âœ© Star outline</option>
              <option value="âœª">âœª Star with circle</option>
              <option value="â›¤">â›¤ Pentagram (open)</option>
              <option value="â›¥">â›¥ Pentagram (filled)</option>
            </optgroup>
            <optgroup label="Blocks & Bars">
              <option value="â–€">â–€ Upper half block</option>
              <option value="â–„">â–„ Lower half block</option>
              <option value="â–ˆ">â–ˆ Full block</option>
              <option value="â–Œ">â–Œ Left half block</option>
              <option value="â–">â– Right half block</option>
              <option value="â–“">â–“ Dark shade</option>
              <option value="â–’">â–’ Medium shade</option>
              <option value="â–‘">â–‘ Light shade</option>
            </optgroup>
            <optgroup label="Arrows">
              <option value="â”">â” Right arrow</option>
              <option value="âœ">âœ Right arrow (thick)</option>
              <option value="â™">â™ Right arrow (medium)</option>
              <option value="â¤">â¤ Black right arrowhead</option>
              <option value="â£">â£ Right arrow small</option>
              <option value="â²">â² Curved right arrow</option>
              <option value="â†©">â†© Left arrow hook</option>
              <option value="â†ª">â†ª Right arrow hook</option>
              <option value="â†»">â†» Clockwise arrow</option>
              <option value="â†º">â†º Counterclockwise arrow</option>
              <option value="â¬†">â¬† Up arrow</option>
              <option value="â¬‡">â¬‡ Down arrow</option>
              <option value="â¬…">â¬… Left arrow</option>
              <option value="â¡">â¡ Right arrow</option>
            </optgroup>
            <optgroup label="Misc">
              <option value="âŒ‚">âŒ‚ House</option>
              <option value="âŒ˜">âŒ˜ Command</option>
              <option value="âŒ›">âŒ› Hourglass</option>
              <option value="â³">â³ Hourglass not done</option>
              <option value="âš™">âš™ Gear</option>
              <option value="âš«">âš« Large black circle</option>
              <option value="âšª">âšª Large white circle</option>
              <option value="â¬¤">â¬¤ Medium black circle</option>
              <option value="â¬›">â¬› Large black square</option>
              <option value="â¬œ">â¬œ Large white square</option>
              <option value="ğŸ”º">ğŸ”º Red triangle up</option>
              <option value="ğŸ”»">ğŸ”» Red triangle down</option>
              <option value="ğŸ”¸">ğŸ”¸ Small orange diamond</option>
              <option value="ğŸ”¹">ğŸ”¹ Small blue diamond</option>
              <option value="ğŸ”·">ğŸ”· Large blue diamond</option>
              <option value="ğŸ”¶">ğŸ”¶ Large orange diamond</option>
            </optgroup>
          </select>
        </label>

  <button id="undo" title="Undo last">â†©ï¸ Undo</button>
  <button id="redo" title="Redo">â†ªï¸ Redo</button>
  <button id="clear" title="Clear canvas">ğŸ—‘ï¸ Clear</button>

        <div id="users">Users: <span id="userList">-</span></div>

        <!-- status/latency on the right -->
        <div id="statusBar">
          <span id="status">Disconnected</span>
          <span id="latency">-- ms</span>
        </div>
      </div>

      <div id="canvasWrap">
        <canvas id="canvas"></canvas>
        <!-- if you prefer a canvas overlay for cursors, keep the same id and swap to a canvas element later -->
        <div id="cursors"></div>
      </div>

      <footer id="footer">
        <span>Open two browser windows to test collaboration. Undo is global (undo last operation).</span>
        <span>
          <a href="https://socket.io" target="_blank" rel="noreferrer" style="color:#22d3ee;text-decoration:none;">Socket.io</a>
        </span>
      </footer>
    </div>

    <!-- Socket.io client must load first -->
    <script src="/socket.io/socket.io.js"></script>

    <!-- Load helpers before code that uses them -->
    <script src="utils.js"></script>

    <!-- Your Socket wrapper (updated to allow websocket/polling + status events) -->
    <script src="websocket.js"></script>

    <!-- Canvas + app code -->
    <script src="canvas.js"></script>
    <script src="main.js"></script>

    <!-- Optional: lightweight status wiring if your main.js doesnâ€™t set it -->
    <script>
      // If main.js already sets status/latency, this is harmless.
      if (window.WS && typeof window.WS.on === 'function') {
        WS.on('status', txt => {
          const el = document.getElementById('status');
          if (el) el.textContent = txt;
        });
        // If you later add ping/pong in your server, you can forward 'latency' here.
        WS.on('latency', ms => {
          const el = document.getElementById('latency');
          if (el) el.textContent = ms + ' ms';
        });
      }
    </script>
  </body>
</html>
